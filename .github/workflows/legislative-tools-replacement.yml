name: ğŸ”§ Herramientas Legislativas (Reemplazo de Scripts)

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Herramienta a ejecutar'
        required: true
        type: choice
        options:
        - validate-proposal
        - generate-acta
        - legislative-support
      issue_number:
        description: 'NÃºmero del Issue'
        required: true
        type: string
      additional_params:
        description: 'ParÃ¡metros adicionales (opcional)'
        required: false
        type: string

jobs:
  validate-proposal-replacement:
    name: ğŸ” Validar Propuesta (Reemplaza Script)
    runs-on: ubuntu-latest
    if: github.event.inputs.action == 'validate-proposal'
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4
        
      - name: Obtener versiÃ³n dinÃ¡mica
        id: get-version
        run: |
          if [ -f ".version" ]; then
            VERSION=$(cat .version)
          elif [ -f "CHANGELOG.md" ]; then
            VERSION=$(grep -m 1 "^## \[" CHANGELOG.md | sed 's/## \[\([^]]*\)\].*/\1/')
          else
            VERSION="3.0.0"
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "ğŸ›ï¸ VersiÃ³n actual: v$VERSION"
          
      - name: ğŸ” ValidaciÃ³n Completa (Sin Scripts)
        id: validate
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = "${{ github.event.inputs.issue_number }}";
            const version = "${{ steps.get-version.outputs.version }}";
            
            console.log('ğŸ” Validador de Propuestas Legislativas v' + version);
            console.log('==================================================');
            
            // Obtener informaciÃ³n del issue
            const { data: issue } = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: parseInt(issueNumber)
            });
            
            const title = issue.title;
            const body = issue.body || '';
            const labels = issue.labels.map(l => l.name);
            const author = issue.user.login;
            
            console.log('ğŸ“ Autor: @' + author);
            console.log('ğŸ·ï¸ Etiquetas: ' + labels.join(', '));
            console.log('ğŸ“‹ Issue encontrado: ' + title);
            
            // SISTEMA DE VALIDACIÃ“N COMPLETO
            let validationsPassed = 0;
            const totalValidations = 8;
            let validationResults = [];
            
            // 1. Validar formato del tÃ­tulo
            if (/^\[(LEGISLATIVO|RESPALDADA|URGENTE)\]/.test(title)) {
              validationsPassed++;
              validationResults.push('âœ… Formato del tÃ­tulo: VÃLIDO');
            } else {
              validationResults.push('âŒ Formato del tÃ­tulo: INVÃLIDO - Debe comenzar con [LEGISLATIVO], [RESPALDADA] o [URGENTE]');
            }
            
            // 2. Validar etiquetas requeridas
            const hasValidLabels = labels.some(label => 
              ['legislativo', 'respaldo-legislativo', 'urgente', 'reforma-constitucional'].includes(label)
            );
            if (hasValidLabels) {
              validationsPassed++;
              validationResults.push('âœ… Etiquetas requeridas: VÃLIDO');
            } else {
              validationResults.push('âŒ Etiquetas requeridas: INVÃLIDO - Falta etiqueta legislativa apropiada');
            }
            
            // 3. Validar estructura del contenido
            const requiredSections = ['Propuesta', 'JustificaciÃ³n', 'AnÃ¡lisis'];
            let structureValid = true;
            for (const section of requiredSections) {
              if (!body.toLowerCase().includes(section.toLowerCase())) {
                structureValid = false;
                break;
              }
            }
            if (structureValid) {
              validationsPassed++;
              validationResults.push('âœ… Estructura del contenido: VÃLIDO');
            } else {
              validationResults.push('âŒ Estructura del contenido: INVÃLIDO - Faltan secciones: ' + requiredSections.join(', '));
            }
            
            // 4. Validar tipo de versionado
            if (/MAJOR|MINOR|PATCH/i.test(body)) {
              validationsPassed++;
              validationResults.push('âœ… Tipo de versionado: ESPECIFICADO');
            } else {
              validationResults.push('âŒ Tipo de versionado: NO ESPECIFICADO - Debe incluir MAJOR/MINOR/PATCH');
            }
            
            // 5. Validar justificaciÃ³n constitucional
            if (/artÃ­culo|constitucional|principio/i.test(body)) {
              validationsPassed++;
              validationResults.push('âœ… JustificaciÃ³n constitucional: PRESENTE');
            } else {
              validationResults.push('âš ï¸ JustificaciÃ³n constitucional: PARCIAL - Recomendado incluir referencias constitucionales');
            }
            
            // 6. Validar checklist de pre-validaciÃ³n
            const checklistCount = (body.match(/- \[[ x]\]/g) || []).length;
            if (checklistCount > 3) {
              validationsPassed++;
              validationResults.push('âœ… Checklist de validaciÃ³n: COMPLETO');
            } else {
              validationResults.push('âš ï¸ Checklist de validaciÃ³n: PARCIAL - Recomendado mÃ¡s elementos en checklist');
            }
            
            // 7. Validar autorizaciÃ³n legislativa
            const isLegislative = labels.includes('legislativo') && /MIEMBRO DEL ALTO CONGRESO/i.test(body);
            const hasBackup = labels.includes('respaldo-legislativo');
            if (isLegislative || hasBackup) {
              validationsPassed++;
              validationResults.push('âœ… AutorizaciÃ³n legislativa: VÃLIDA');
            } else {
              validationResults.push('âš ï¸ AutorizaciÃ³n legislativa: REVISAR - Verificar autorizaciÃ³n del proponente');
            }
            
            // 8. Validar coherencia constitucional
            if (/ArtÃ­culo 4|principios|valores/i.test(body)) {
              validationsPassed++;
              validationResults.push('âœ… Coherencia constitucional: VERIFICADA');
            } else {
              validationResults.push('âš ï¸ Coherencia constitucional: PARCIAL - Verificar alineaciÃ³n con ArtÃ­culo 4');
            }
            
            // Calcular resultado final
            const percentage = Math.floor((validationsPassed * 100) / totalValidations);
            
            let status, statusIcon;
            if (validationsPassed === totalValidations) {
              status = 'COMPLETAMENTE VÃLIDA';
              statusIcon = 'ğŸ‰';
            } else if (validationsPassed >= 6) {
              status = 'PARCIALMENTE VÃLIDA';
              statusIcon = 'âš ï¸';
            } else {
              status = 'REQUIERE MEJORAS';
              statusIcon = 'âŒ';
            }
            
            console.log('ğŸ“Š ValidaciÃ³n completada: ' + percentage + '% (' + validationsPassed + '/' + totalValidations + ')');
            
            // Crear comentario de validaciÃ³n simple
            const validationComment = '## ğŸ¤– ValidaciÃ³n AutomÃ¡tica Completada (GitHub Actions)\n\n' +
              '**' + statusIcon + ' RESULTADO:** ' + status + ' (' + percentage + '% validaciones pasadas)\n\n' +
              '### ğŸ“‹ Detalles de ValidaciÃ³n:\n' +
              validationResults.map(result => '- ' + result).join('\n') + '\n\n' +
              '### ğŸš€ InformaciÃ³n del Sistema:\n' +
              '- **Ejecutado por:** GitHub Actions v' + version + '\n' +
              '- **Fecha:** ' + new Date().toLocaleString('es-ES') + '\n' +
              '- **Sin scripts locales:** âœ… Completamente automatizado\n' +
              '- **Historial:** Disponible en Actions tab\n\n' +
              '### ğŸ“Š EstadÃ­sticas:\n' +
              '- **Validaciones pasadas:** ' + validationsPassed + '/' + totalValidations + '\n' +
              '- **Porcentaje de Ã©xito:** ' + percentage + '%\n' +
              '- **Estado:** ' + status + '\n\n' +
              (validationsPassed === totalValidations 
                ? '### âœ… PrÃ³ximos Pasos:\n' +
                  '1. â±ï¸ PerÃ­odo de debate pÃºblico (mÃ­nimo segÃºn tipo de propuesta)\n' +
                  '2. ğŸ—³ï¸ VotaciÃ³n del Alto Congreso Tlatocan\n' +
                  '3. ğŸ“‹ ImplementaciÃ³n tÃ©cnica tras aprobaciÃ³n'
                : validationsPassed >= 6
                ? '### âš ï¸ Recomendaciones:\n' +
                  '- Completar secciones faltantes\n' +
                  '- Agregar mÃ¡s detalle en justificaciÃ³n\n' +
                  '- Revisar coherencia constitucional'
                : '### âŒ Acciones Requeridas:\n' +
                  '- Corregir formato y estructura\n' +
                  '- Completar secciones obligatorias\n' +
                  '- Incluir justificaciÃ³n constitucional\n' +
                  '- Ver [GuÃ­a TÃ©cnica](../Legislativo/GUIA_TECNICA_LEGISLATIVA.md)'
              ) + '\n\n---\n' +
              '**ğŸ›ï¸ Sistema Legislativo GitHub Actions v' + version + '**\n' +
              '*Reemplaza completamente los scripts validate-proposal.sh*';
            
            // Publicar comentario
            await github.rest.issues.createComment({
              issue_number: parseInt(issueNumber),
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: validationComment
            });
            
            console.log('âœ… ValidaciÃ³n completada y comentario publicado');
            
            // Outputs para otros jobs
            core.setOutput('validation-status', status);
            core.setOutput('validation-percentage', percentage);
            core.setOutput('validations-passed', validationsPassed);

  generate-acta-replacement:
    name: ğŸ“‹ Generar Acta (Reemplaza Script)
    runs-on: ubuntu-latest
    if: github.event.inputs.action == 'generate-acta'
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4
        
      - name: Obtener versiÃ³n dinÃ¡mica
        id: get-version
        run: |
          if [ -f ".version" ]; then
            VERSION=$(cat .version)
          elif [ -f "CHANGELOG.md" ]; then
            VERSION=$(grep -m 1 "^## \[" CHANGELOG.md | sed 's/## \[\([^]]*\)\].*/\1/')
          else
            VERSION="3.0.0"
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          
      - name: ğŸ“‹ GeneraciÃ³n Completa de Acta (Sin Scripts)
        id: generate-acta
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = "${{ github.event.inputs.issue_number }}";
            const version = "${{ steps.get-version.outputs.version }}";
            
            console.log('ğŸ“‹ Generador de Actas de VotaciÃ³n v' + version);
            console.log('==============================================');
            
            // Obtener informaciÃ³n del issue y comentarios
            const { data: issue } = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: parseInt(issueNumber)
            });
            
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: parseInt(issueNumber)
            });
            
            const title = issue.title;
            const author = issue.user.login;
            const createdAt = issue.created_at;
            const labels = issue.labels.map(l => l.name);
            
            console.log('ğŸ“ Recopilando votos para: ' + title);
            
            // PROCESAR VOTOS
            const votes = {
              favor: [],
              contra: [],
              abstenciones: []
            };
            
            let votingComments = [];
            
            for (const comment of comments) {
              const body = comment.body.toLowerCase();
              const commentAuthor = comment.user.login;
              const commentDate = comment.created_at;
              
              if (body.includes('voto oficial') || 
                  body.includes('apruebo') || 
                  body.includes('rechazo') || 
                  body.includes('abstenciÃ³n')) {
                
                let voteType = 'desconocido';
                if (body.includes('âœ…') || body.includes('apruebo') || body.includes('a favor')) {
                  votes.favor.push({ author: commentAuthor, date: commentDate });
                  voteType = 'A FAVOR';
                } else if (body.includes('âŒ') || body.includes('rechazo') || body.includes('en contra')) {
                  votes.contra.push({ author: commentAuthor, date: commentDate });
                  voteType = 'EN CONTRA';
                } else if (body.includes('ğŸŸ¡') || body.includes('abstenciÃ³n') || body.includes('abstengo')) {
                  votes.abstenciones.push({ author: commentAuthor, date: commentDate });
                  voteType = 'ABSTENCIÃ“N';
                }
                
                votingComments.push('- @' + commentAuthor + ' (' + voteType + ') - ' + new Date(commentDate).toLocaleString('es-ES'));
              }
            }
            
            // Calcular estadÃ­sticas
            const totalFavor = votes.favor.length;
            const totalContra = votes.contra.length;
            const totalAbstenciones = votes.abstenciones.length;
            const totalVotos = totalFavor + totalContra + totalAbstenciones;
            
            const porcentajeFavor = totalVotos > 0 ? Math.round((totalFavor * 100) / totalVotos) : 0;
            const porcentajeContra = totalVotos > 0 ? Math.round((totalContra * 100) / totalVotos) : 0;
            
            // Determinar resultado segÃºn tipo de propuesta
            const isConstitutional = labels.includes('reforma-constitucional');
            const mayoriaRequerida = isConstitutional ? Math.ceil(totalVotos * 2 / 3) : Math.ceil(totalVotos / 2);
            const tipoMayoria = isConstitutional ? '2/3 (Reforma Constitucional)' : 'Simple (Ley Ordinaria)';
            
            const resultado = totalFavor >= mayoriaRequerida ? 'âœ… APROBADA' : 'âŒ RECHAZADA';
            
            console.log('ğŸ“Š Votos procesados: ' + totalVotos + ' total (' + totalFavor + ' favor, ' + totalContra + ' contra, ' + totalAbstenciones + ' abstenciones)');
            
            // Generar hash de verificaciÃ³n
            const hashContent = title + '-' + issueNumber + '-' + new Date().toISOString();
            const crypto = require('crypto');
            const hashVerificacion = crypto.createHash('sha256').update(hashContent).digest('hex').substring(0, 16);
            
            // CREAR ACTA OFICIAL simplificada
            const actaTitle = '[ACTA OFICIAL] VotaciÃ³n #' + issueNumber + ' - ' + title.replace(/^\[(LEGISLATIVO|RESPALDADA|URGENTE)\]\s*/, '');
            
            const actaBody = '# ğŸ“‹ ACTA OFICIAL DE VOTACIÃ“N\n\n' +
              '**Alto Congreso Tlatocan - UniÃ³n Untravel**\n\n' +
              '---\n\n' +
              '## ğŸ“Š INFORMACIÃ“N GENERAL\n\n' +
              '- **NÃºmero de Propuesta:** #' + issueNumber + '\n' +
              '- **TÃ­tulo:** ' + title + '\n' +
              '- **Proponente:** @' + author + '\n' +
              '- **Fecha de Propuesta:** ' + new Date(createdAt).toLocaleDateString('es-ES') + '\n' +
              '- **Fecha de VotaciÃ³n:** ' + new Date().toLocaleDateString('es-ES') + '\n' +
              '- **Tipo de Propuesta:** ' + labels.join(', ') + '\n' +
              '- **Sistema:** GitHub Actions v' + version + '\n' +
              '- **Secretario Actuante:** Sistema Automatizado\n\n' +
              '---\n\n' +
              '## ğŸ—³ï¸ RESULTADO DE LA VOTACIÃ“N\n\n' +
              '### ' + resultado + '\n\n' +
              '### Resumen EstadÃ­stico\n\n' +
              '- âœ… **A FAVOR:** ' + totalFavor + ' votos (' + porcentajeFavor + '%)\n' +
              '- âŒ **EN CONTRA:** ' + totalContra + ' votos (' + porcentajeContra + '%)\n' +
              '- ğŸŸ¡ **ABSTENCIONES:** ' + totalAbstenciones + ' votos (' + Math.round((totalAbstenciones * 100) / (totalVotos || 1)) + '%)\n' +
              '- **TOTAL:** ' + totalVotos + ' votos (100%)\n\n' +
              '### AnÃ¡lisis de QuÃ³rum y MayorÃ­as\n\n' +
              '- **Tipo de mayorÃ­a requerida:** ' + tipoMayoria + '\n' +
              '- **Votos necesarios para aprobar:** ' + mayoriaRequerida + '\n' +
              '- **Votos a favor obtenidos:** ' + totalFavor + '\n' +
              '- **Estado del quÃ³rum:** ' + (totalVotos >= 3 ? 'âœ… ALCANZADO' : 'âŒ INSUFICIENTE') + ' (mÃ­nimo 3 legisladores)\n\n' +
              '---\n\n' +
              '## ğŸ›ï¸ DECISIÃ“N OFICIAL\n\n' +
              '> ### ' + resultado + '\n' +
              '> \n' +
              '> ' + (totalFavor >= mayoriaRequerida 
                ? 'La propuesta ha sido **APROBADA** por el Alto Congreso Tlatocan con ' + totalFavor + ' votos a favor de un total de ' + totalVotos + ' votos emitidos.'
                : 'La propuesta ha sido **RECHAZADA** por el Alto Congreso Tlatocan. No alcanzÃ³ la mayorÃ­a requerida de ' + mayoriaRequerida + ' votos.'
              ) + '\n\n' +
              '### Base Legal\n' +
              '- **ArtÃ­culo 15:** Reglamento de VotaciÃ³n del Alto Congreso Tlatocan\n' +
              '- **ArtÃ­culo 16:** Proceso Legislativo\n' +
              (labels.includes('reforma-constitucional') ? '- **ArtÃ­culo 35:** Reforma de la ConstituciÃ³n\n' : '') + '\n' +
              '---\n\n' +
              '## ğŸ“ REGISTRO DETALLADO DE VOTOS\n\n' +
              '### Votos Registrados CronolÃ³gicamente\n\n' +
              (votingComments.length > 0 ? votingComments.join('\n') : 'âš ï¸ No se encontraron votos formales registrados en los comentarios del issue.') + '\n\n' +
              '---\n\n' +
              '## âœï¸ CERTIFICACIÃ“N AUTOMÃTICA\n\n' +
              'Este acta ha sido generada automÃ¡ticamente por el **Sistema GitHub Actions v' + version + '** del Alto Congreso Tlatocan.\n\n' +
              '**Hash de verificaciÃ³n:** ' + hashVerificacion + '\n' +
              '**Timestamp:** ' + new Date().toISOString() + '\n' +
              '**Sin dependencias de scripts:** âœ… Completamente automatizado\n\n' +
              '---\n\n' +
              '### ğŸ›ï¸ Sello Oficial\n\n' +
              '**Alto Congreso Tlatocan**\n' +
              '**UniÃ³n Untravel**\n' +
              '**Sistema GitHub Actions v' + version + '**\n\n' +
              '*"Transparencia, Democracia y Justicia Digital"*\n\n' +
              '---\n\n' +
              '*Acta generada automÃ¡ticamente el ' + new Date().toLocaleDateString('es-ES') + '*\n' +
              '*Reemplaza completamente generate-acta.sh - Sin scripts externos*\n' +
              '*Para verificaciones: [GitHub Issue Original #' + issueNumber + '](../../issues/' + issueNumber + ')*';
            
            // Crear el issue del acta
            const { data: actaIssue } = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: actaTitle,
              body: actaBody,
              labels: ['acta-oficial', 'github-actions-generated']
            });
            
            console.log('ğŸ“‹ Acta oficial creada como Issue #' + actaIssue.number);
            
            // Comentar en el issue original
            const resumenComment = '## ğŸ“‹ Acta Oficial Generada (GitHub Actions)\n\n' +
              '**' + resultado + '** (' + porcentajeFavor + '% a favor)\n\n' +
              '**ğŸ“Š EstadÃ­sticas finales:**\n' +
              '- âœ… Votos a favor: **' + totalFavor + '**\n' +
              '- âŒ Votos en contra: **' + totalContra + '**\n' +
              '- ğŸŸ¡ Abstenciones: **' + totalAbstenciones + '**\n' +
              '- ğŸ“Š Total de votos: **' + totalVotos + '**\n\n' +
              '**MayorÃ­a requerida:** ' + tipoMayoria + ' (' + mayoriaRequerida + ' votos)\n\n' +
              '**ğŸ“„ Acta oficial completa:** #' + actaIssue.number + '\n' +
              '**ğŸ›ï¸ Sistema:** GitHub Actions v' + version + ' (sin scripts .sh)\n' +
              '**â° Generada:** ' + new Date().toLocaleDateString('es-ES') + '\n\n' +
              (totalFavor >= mayoriaRequerida 
                ? 'ğŸ‰ **Â¡Propuesta aprobada oficialmente!** Proceder con implementaciÃ³n tÃ©cnica.'
                : 'ğŸ“ **Propuesta no aprobada.** Revisar feedback para mejoras futuras.'
              ) + '\n\n' +
              '---\n' +
              '**ğŸš€ Ventajas del sistema GitHub Actions:**\n' +
              '- âœ… Sin dependencias de scripts locales\n' +
              '- âœ… Historial inmutable y auditable\n' +
              '- âœ… IntegraciÃ³n nativa con GitHub\n' +
              '- âœ… CertificaciÃ³n automÃ¡tica con hash\n\n' +
              '*Procesado completamente por GitHub Actions - Reemplaza generate-acta.sh*';
            
            await github.rest.issues.createComment({
              issue_number: parseInt(issueNumber),
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: resumenComment
            });
            
            console.log('âœ… Acta generada y comentario de resumen publicado');
            
            // Outputs
            core.setOutput('acta-issue', actaIssue.number);
            core.setOutput('resultado', resultado);
            core.setOutput('total-votos', totalVotos);

  legislative-support:
    name: ğŸ›ï¸ Soporte Legislativo Automatizado
    runs-on: ubuntu-latest
    if: github.event.inputs.action == 'legislative-support'
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v4
        
      - name: Obtener versiÃ³n dinÃ¡mica
        id: get-version
        run: |
          if [ -f ".version" ]; then
            VERSION=$(cat .version)
          elif [ -f "CHANGELOG.md" ]; then
            VERSION=$(grep -m 1 "^## \[" CHANGELOG.md | sed 's/## \[\([^]]*\)\].*/\1/')
          else
            VERSION="3.0.0"
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          
      - name: ğŸ›ï¸ AnÃ¡lisis y Soporte Legislativo
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = "${{ github.event.inputs.issue_number }}";
            const version = "${{ steps.get-version.outputs.version }}";
            const params = "${{ github.event.inputs.additional_params }}";
            
            console.log('ğŸ›ï¸ Sistema de Soporte Legislativo Automatizado');
            console.log('ğŸ“‹ Analizando issue #' + issueNumber + ' con parÃ¡metros: ' + params);
            
            // Obtener informaciÃ³n del issue
            const { data: issue } = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: parseInt(issueNumber)
            });
            
            const title = issue.title;
            const body = issue.body || '';
            
            // Buscar issues relacionados
            const { data: relatedIssues } = await github.rest.search.issuesAndPullRequests({
              q: `repo:${context.repo.owner}/${context.repo.repo} is:issue label:legislativo,reforma-constitucional`,
              sort: 'created',
              order: 'desc',
              per_page: 10
            });
            
            // AnÃ¡lisis de tendencias legislativas
            const legislativeStats = {
              totalPropuestas: relatedIssues.total_count,
              propuestasRecientes: relatedIssues.items.length,
              tiposComunes: {}
            };
            
            relatedIssues.items.forEach(item => {
              const labels = item.labels.map(l => l.name);
              labels.forEach(label => {
                legislativeStats.tiposComunes[label] = (legislativeStats.tiposComunes[label] || 0) + 1;
              });
            });
            
            // Generar reporte de soporte
            const supportReport = '## ğŸ›ï¸ Reporte de Soporte Legislativo Automatizado\n\n' +
              '**Issue analizado:** #' + issueNumber + ' - ' + title + '\n' +
              '**Sistema:** GitHub Actions v' + version + '\n' +
              '**Fecha:** ' + new Date().toLocaleDateString('es-ES') + '\n\n' +
              '### ğŸ“Š AnÃ¡lisis de Contexto Legislativo\n\n' +
              '**ğŸ“ˆ EstadÃ­sticas del repositorio:**\n' +
              '- Total de propuestas legislativas: ' + legislativeStats.totalPropuestas + '\n' +
              '- Propuestas recientes: ' + legislativeStats.propuestasRecientes + '\n\n' +
              '**ğŸ·ï¸ Tipos mÃ¡s comunes:**\n' +
              Object.entries(legislativeStats.tiposComunes)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([label, count]) => '- ' + label + ': ' + count + ' casos')
                .join('\n') + '\n\n' +
              '### ğŸ“š Propuestas Relacionadas Recientes\n\n' +
              relatedIssues.items.slice(0, 5).map(item => 
                '- [#' + item.number + '](' + item.html_url + ') - ' + item.title + ' (' + item.state + ')'
              ).join('\n') + '\n\n' +
              '### ğŸ” Recomendaciones AutomÃ¡ticas\n\n' +
              (body.toLowerCase().includes('artÃ­culo') 
                ? 'âœ… **Referencias constitucionales:** Presentes en la propuesta'
                : 'âš ï¸ **RecomendaciÃ³n:** Agregar referencias especÃ­ficas a artÃ­culos constitucionales'
              ) + '\n\n' +
              (body.toLowerCase().includes('justificaciÃ³n') 
                ? 'âœ… **JustificaciÃ³n:** SecciÃ³n identificada'
                : 'âš ï¸ **RecomendaciÃ³n:** Expandir la justificaciÃ³n de la propuesta'
              ) + '\n\n' +
              '### ğŸš€ PrÃ³ximos Pasos Sugeridos\n\n' +
              '1. **ğŸ“‹ RevisiÃ³n:** Usar el validador automÃ¡tico de propuestas\n' +
              '2. **ğŸ—³ï¸ VotaciÃ³n:** Coordinar con miembros del Alto Congreso\n' +
              '3. **ğŸ“„ DocumentaciÃ³n:** Preparar implementaciÃ³n tÃ©cnica\n\n' +
              '### ğŸ›ï¸ Recursos Legislativos\n\n' +
              '- [ğŸ“– GuÃ­a TÃ©cnica Legislativa](../Legislativo/GUIA_TECNICA_LEGISLATIVA.md)\n' +
              '- [ğŸ“‹ Plantillas de Issues](.github/ISSUE_TEMPLATE/)\n' +
              '- [ğŸ“Š ConstituciÃ³n Actual](../CONSTITUTION.md)\n\n' +
              '---\n\n' +
              '**ğŸ¤– AnÃ¡lisis generado automÃ¡ticamente por GitHub Actions v' + version + '**\n' +
              '*Sistema de soporte legislativo sin dependencias de scripts externos*';
            
            // Publicar reporte
            await github.rest.issues.createComment({
              issue_number: parseInt(issueNumber),
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: supportReport
            });
            
            console.log('âœ… Reporte de soporte legislativo generado y publicado');

  summary:
    name: ğŸ“Š Resumen de EjecuciÃ³n
    runs-on: ubuntu-latest
    needs: [validate-proposal-replacement, generate-acta-replacement, legislative-support]
    if: always()
    steps:
      - name: ğŸ“Š Generar resumen de ejecuciÃ³n
        run: |
          echo "# ğŸ‰ Herramientas Legislativas GitHub Actions"
          echo "============================================="
          echo ""
          echo "## âœ… Estado de EjecuciÃ³n:"
          echo "- ğŸ” **Validador:** ${{ needs.validate-proposal-replacement.result }}"
          echo "- ğŸ“‹ **Generador de Actas:** ${{ needs.generate-acta-replacement.result }}"  
          echo "- ğŸ›ï¸ **Soporte Legislativo:** ${{ needs.legislative-support.result }}"
          echo ""
          echo "## ğŸš€ **SCRIPTS .SH OFICIALMENTE REEMPLAZADOS:**"
          echo "- âŒ ~~validate-proposal.sh~~ â†’ âœ… GitHub Actions"
          echo "- âŒ ~~generate-acta.sh~~ â†’ âœ… GitHub Actions"
          echo "- â• **NUEVO:** Soporte legislativo automatizado"
          echo ""
          echo "## ğŸ›ï¸ Beneficios del Sistema GitHub Actions:"
          echo "- âœ… **Sin dependencias locales** (gh, jq, bash)"
          echo "- âœ… **EjecuciÃ³n en la nube** con logs persistentes"
          echo "- âœ… **IntegraciÃ³n nativa** con GitHub Issues y API"
          echo "- âœ… **Historial auditable** e inmutable"
          echo "- âœ… **Escalabilidad automÃ¡tica** sin configuraciÃ³n"
          echo "- âœ… **CertificaciÃ³n criptogrÃ¡fica** automÃ¡tica"
          echo ""
          echo "ğŸ›ï¸ **El Alto Congreso Tlatoani ahora opera 100% en GitHub Actions**"